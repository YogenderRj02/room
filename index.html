<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Expense List</title>
</head>
<body>

<h2>Expense List</h2>

<p id="message" style="color:red;"></p>

<table border="1" id="expenseTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Date</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>

const proxy = "https://api.allorigins.win/raw?url=";
const apiURL = "https://te.infinityfreeapp.com/expense.php";

fetch(proxy + encodeURIComponent(apiURL))
.then(response => response.text())
.then(text => {

    // Check if response is HTML (error page)
    if (text.startsWith("<")) {
        document.getElementById("message").innerText =
            "Server JSON return nahi kar raha. Backend check karo.";
        console.error("HTML received instead of JSON:", text);
        return;
    }

    try {
        const data = JSON.parse(text);

        let tbody = document.querySelector("#expenseTable tbody");
        tbody.innerHTML = "";

        if (data.length === 0) {
            document.getElementById("message").innerText = "No expense data found.";
            return;
        }

        data.forEach(item => {
            let row = `
                <tr>
                    <td>${item.id ?? ''}</td>
                    <td>${item.description ?? ''}</td>
                    <td>${item.amount ?? ''}</td>
                    <td>${item.date ?? ''}</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });

    } catch (error) {
        document.getElementById("message").innerText =
            "Invalid JSON format from server.";
        console.error("JSON Parse Error:", error);
    }

})
.catch(error => {
    document.getElementById("message").innerText =
        "Fetch failed. CORS ya server issue ho sakta hai.";
    console.error("Fetch error:", error);
});

</script>

</body>
</html>
